<!DOCTYPE html>
<html>
<head>
  <title>Cart</title>
  <link rel="stylesheet" href="style.css">
  <style>
    #header { display: flex; justify-content: space-between; margin-bottom: 20px; }
    .cart-item { margin-bottom: 20px; }
  </style>
</head>
<body>
  <div id="header">
    <div>
      <strong id="userInfo"></strong><br>
      <span id="loginTime"></span>
    </div>
    <button onclick="logout()">Logout</button>
  </div>

  <h2>Your Cart</h2>
  <div id="cartItems"></div>
  <button onclick="sendToSFMC()">Send to SFMC</button>

  <form id="sfmcForm" action="https://mcbpcpxtk6qzkpnzk1spgzn07rh0.pub.sfmc-content.com/dyp1jbqcr2l" method="POST" style="display:none">
    <input type="hidden" name="Email" id="sfmcEmail">
    <input type="hidden" name="Name" id="sfmcName">
    <input type="hidden" name="Timestamp" id="sfmcTimestamp">
    <input type="hidden" name="CartItems" id="sfmcCartItems">
  </form>

  <script>
    const name = localStorage.getItem("user_name");
    const email = localStorage.getItem("user_email");
    const loginTime = localStorage.getItem("login_time");

    if (!email) {
      window.location.href = "login.html";
    }

    document.getElementById("userInfo").textContent = `Logged in as: ${name} (${email})`;
    document.getElementById("loginTime").textContent = `Login Time: ${loginTime}`;

    const cartKey = `cart_items_${email}`;
    const cart = JSON.parse(localStorage.getItem(cartKey)) || [];

    const container = document.getElementById("cartItems");
    cart.forEach(item => {
      const div = document.createElement("div");
      div.className = "cart-item";
      div.innerHTML = `
        <img src="${item.image}" alt="${item.name}" /><br/>
        <strong>${item.name}</strong><br/>
        Quantity: ${item.quantity}<br/>
        Price: $${item.price} each<br/>
        <hr/>
      `;
      container.appendChild(div);
    });

    function sendToSFMC() {
      document.getElementById("sfmcEmail").value = email;
      document.getElementById("sfmcName").value = name;
      document.getElementById("sfmcTimestamp").value = loginTime;
      document.getElementById("sfmcCartItems").value = JSON.stringify(cart);
      document.getElementById("sfmcForm").submit();
    }

    function logout() {
      localStorage.clear();
      window.location.href = "login.html";
    }
  </script>
</body>
</html>
